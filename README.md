# ESSCompress v2.0

A tool to compress a spectrum-preserving string set (SPSS) representation of a set of k-mers using compacted de Bruijn graph.

## Requirements

For `essCompress` and `essDecompress`  

- GCC >= 4.8 or a C++11 capable compiler

- Linux/unix operating system

- Git

The software has a few third-party dependencies. 

- DSK

- BCALM 
 
- MFCompress 

Check the respective links for additional requirements.


## Full installation

1) Download and compile from source:

       git clone https://github.com/medvedevgroup/ESSCompress
       cd ESSCompress
       make

This will install `essCompress` and `essDecompress` in the `bin` folder.

2) Add the `bin` folder to your PATH environment.

       export PATH="$PWD/bin:$PATH"
       source ~/.bashrc
	
3) Install `essCompress`, `essDecompress` and third party tools using:

       sh INSTALL

Upon successful execution of this script, you will see binaries for `essCompress`, `essDecompress`, `dsk`, `bcalm` and `mfc` in the `bin` folder.

4) Use the script `compress.sh` to compress and `decompress.sh` to decompress.

Compression:
	
       Syntax: ./compress.sh [options]
       options: 
       -i [filepath]     Input file (include full path)
	   -k [INT]          k-mer size
	   -a [INT]          min-abundance (default 2)
	   -o [path]	     directory to output 
	   -m [0,1,2]        compression mode (default 0); 0=ess(high compression), 1=ess-tip(low memory compression), 2=no compression (plain spss)
	   -t [1 or 0]       Specify input type (default 1): 0=fasta/fastq file, 1=cdbG by bcalm
	   -h                Print this Help.
	   -v                Validate the output
	   -V                Print software version and exit.

      
Decompression:
  
        Syntax: ./decompress.sh [file_to_decompress]
     e.g.  
## To install and run `essCompress` and `essDecompress` core algorithm only

1) Download and compile from source:

       git clone https://github.com/medvedevgroup/ESSCompress
       cd ESSCompress
       make

This will install `essCompress` and `essDecompress` in the `bin` folder.

2) Add the `bin` folder to your PATH environment.

       export PATH="$PWD/bin:$PATH"
       source ~/.bashrc


3) After compiling and setting PATH variable, you can run compression on a compacted de Bruijn graph file generated by BCALM:

       essCompress -i [bcalm2 cdbg file] -k [kmer_size] -t [1 or 0]

e.g.

    essCompress -i examples/cdbg/chol_k11.unitigs.fa -k 11 -t 0


The important parameters are:

*  `k [int]` : The k-mer size that was used to generate the input, i.e. the length of the nodes of the node-centric de Bruijn graph.
*  `i [input-file]` : Unitigs file produced by [BCALM2 in FASTA format](https://github.com/GATB/bcalm#output).
*  `t [0 or 1]` : Default is 1. 0 ==> tip mode off, 1 ==> tip mode on.

The output is a compressed ESS file with extenstion ".ess" (non-tip mode) or ".esstip (tip mode) in the working folder.

To decompress:

    essDecompress [file_to_decompress]
e.g.

    essDecompress kmers.ess
The decompressed file is a text file in the working folder containing the k-mers in SPSS format. 

## Citation

If using ESS-Compresss in your research, please cite
* Amatur Rahman, Rayan Chikhi and Paul Medvedev, Disk compression of k-mer sets, WABI 2020.
