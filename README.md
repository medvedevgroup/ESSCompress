ESSCompress
===============

A tool to compress a set of k-mers represented in FASTA/FASTQ file(s).


# Installation

The easist way to install ESS is to download and extract the latest Linux 64-bit [binaries](https://github.com/medvedevgroup/ESSCompress/releases/download/v2.0/essCompress-v2.0-linux-64.tar.gz).

```
wget https://github.com/medvedevgroup/ESSCompress/releases/download/v2.0/essCompress-v2.0-linux-64.tar.gz
tar xvzf essCompress-v2.0-linux-64.tar.gz
```

The executable files are now located in the bin `essCompress-v2.0/bin`, relative to the working directory. Optionally, you can add this directory to your PATH variable or move all the files from this directory into another directory in your PATH.

If you prefer to install from source, see [below](#Installation-from-source).

# Quick start 

We illustrate the usage of ESS with an example. Please change into the base directory of the ESS installation. If you have just installed ESS, you can do this by `cd essCompress-v2.0`. The distribution contains a small example fasta file:
```
$cat examples/smallExample.fa
>
AAAAAAACCCCCCCCCC
>
CCCCCCCCCCA
```
To compress this file using a k-mer size 11, run
```
$ bin/essCompress -k 11 -i examples/smallExample.fa
```
The output file is `examples/smallExample.fa.essc`. It is a  binary file, which stores the MFC compressed ESS representation of the k-mers in `examples/smallExample.fa`. To decompress it back into a fasta file, run
```
$ bin/essDecompress examples/smallExample.fa.essc   
```
The output file is `examples/smallExample.fa.essd`. You can check its contents
```
$ cat examples/smallExample.fa.essd 
>
AAAAAAACCCCCCCCCCA
```
Notice that the decompressed fasta file is not the same as the original fasta file, but 
it contains the same k-mers as smallExample.fa. You can double check this by running:

```
$ bin/essAuxValidate 11 examples/smallExample.fa examples/smallExample.fa.essd
Checking whether file 'examples/smallExample.fa' and file 'examples/smallExample.fa.essd' contain same 11-mers...
### SUCCESS: The two files contain same k-mers! ###
```


## Usage details

### essCompress: compression of a k-mer set

       Syntax: ./essCompress [parameters]   

	   -k [int]          k-mer size (must be >=4)
	   -i [input-file]   Path to input file.

	   optional arguments:
	   -a [int]          Default=1. Sets a threshold X, such that k-mers that appear less than X times in the input dataset are filtered out.
	   -f                Fast compression mode: uses less memory, but achieves smaller compression ratio.
	   -v                Enable verbose mode: print more useful information.
	   -c                Verify correctness: check that all the distinct k-mers in the input file appears exactly once in compressed file.
	   -h                Print this Help.


#### Input for essCompress

Two important input parameters are
* input [-i]   
* k-mer size [-k]   

File input format can be   
	1. a single fasta or fastq file (either gzipped or not)   
	2. a single text file containing the list of multiple fasta/fastq files (one file per line)	 

To pass a single file as input and compress: `./bin/essCompress -i examples/11mers.fa -k 11`

To pass several files as input, generate the list of files (one file per line) as follows:

```
ls -1 examples/*.fa > list_reads   
./bin/essCompress -i list_reads -k 5
```

ESS-Compress uses BCALM 2 under the hood, which does not care about paired-end information, all given reads contribute to k-mers in the graph (as long as such k-mers pass the abundance threshold).



#### Output for essCompress
The compressed output is in a file with `.essc` extension.





### essDecompress: decompression of .essc file

        Syntax: ./essDecompress [file_to_decompress]

*Input*: a *.essc* file generated by essCompress   
*Output*: a fasta file with *.essd* extension, where all the distinct k-mers represented by the input .essc file appear exactly once. In other words, output is a [spectrum-preserving string set](http://doi.org/10.1007/978-3-030-45257-5_10).


## Installation from source

### Pre-requisites
- Linux operating system (64 bit)

- Git

- GCC >= 4.8 or a C++11 capable compiler   

- CMake 3.1+   

### Steps

Download source and install:

```
git clone https://github.com/medvedevgroup/ESSCompress
cd ESSCompress
./INSTALL
```

Upon successful execution of this script, you will see linux binaries for [BCALM](https://github.com/GATB/bcalm) (`essAuxBcalm`), [DSK](https://github.com/GATB/dsk) (`essAuxDsk` and `essAuxDsk2ascii`) and [MFCompress](http://bioinformatics.ua.pt/software/mfcompress/) (`essAuxMFCompressC` and `essAuxMFCompressD`) in the `bin` folder, along with `essAuxValidate`, `essAuxCompress` and `essAuxDecompress`. All of these are auxiliary executables. The main two executables are `essCompress` and `essDecompress`.



## Citation

If using ESS-Compresss in your research, please cite
* Amatur Rahman, Rayan Chikhi and Paul Medvedev, Disk compression of k-mer sets, WABI 2020.
